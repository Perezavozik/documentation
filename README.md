# Федеральная Лезгинская Национально-Культурная Автономия (ФЛНКА)
# Информационный портал — Архитектура, Технологии, Концепции, Внутреннее устройство

## Цели проекта
Создать высокопроизводительный, мультиязычный, отказоустойчивый информационный портал федеральной организации ФЛНКА, обеспечивающий:

- публичный доступ к культурно-просветительским материалам,
- многослойную структуру контента (проекты, хроника, мероприятия, документы, отчёты),
- интеграцию с внешними медиа-каналами (Telegram),
- поддержку HTML-контента, мультимедиа и фото-архивов,
- масштабируемость на годы вперёд.

Архитектура разделена на два независимых слоя:

1. **Backend (Django/DRF)** — API-ядро
2. **Frontend (Next.js / React / TypeScript)** — презентационный уровень
3. **Дизайн** - https://pixso.net/app/design/ysMCKjdf2sSIA79AjpZrRQ?icon_type=1&page-id=0%3A1

Проект запланирован как долгоживущий: архитектура выдерживает рост данных, расширение функционала, добавление новых приложений и API-методов.

---

# Архитектура системы (высокоуровневое описание)

[Next.js SSR/SSG] ←→ [Axios API Client] ←→ [Django REST Framework] ←→ [PostgreSQL]
↑
[CSRF / Cookies]
↑
[next-intl локализация]


### Разделение ответственности
- **Backend** — чистая логика данных, структуры, сортировки, переводов, медиа.
- **Frontend** — рендеринг, маршрутизация, интерактив, кэширование, оптимизация.

### Основные инженерные принципы

- **Строгий REST API** (без смешивания view-логики)
- **Явные типы, контракты и схемы данных** (TypeScript + DRF Serializers)
- **Никаких "сырых" HTML вставок**, используется безопасный парсер
- **На фронте не хранится состояние данных** — всё тянется из API
- **SSR/SSG гибрид** для быстрого публичного доступа
- **Кеширование изображений особенно для парсера телеграм** для быстрого публичного доступа
- **Zero-config scale ready** — всё можно завернуть в k8s & Docker

---

# Полный стек технологий

## Backend
- Python 3.10+
- Django 4.x
- Django REST Framework
- django-parler (i18n для моделей)
- django-cors-headers
- drf-spectacular (OpenAPI schema)
- Postgres (рекомендуется PG 14+)
- Pillow
- CKEditor 5 (rich text)
- Gunicorn/Uvicorn/Nginx (prod-ready)
- Redis (опционально, для кешей)
- Celery (легко подключается для уведомлений и фоновых задач)

## Frontend
- Node.js 18+
- Next.js 14 (App Router)
- React 18
- TypeScript 5
- Axios (на уровне SDK)
- next-intl (i18n)
- Redux Toolkit
- yet-another-react-lightbox
- html-react-parser
- CSS Modules
- Docker
- Vercel / PM2 Ready

---

# Основные технические сложности и их решения

### 1) **Двухуровневая мультиязычность**

**Сложность:**  
Необходимо поддерживать несколько языков как на сервере (переводимые модели), так и на клиенте (json локали + серверный рендер).  
При этом важно, чтобы API не слало весь набор переводов, а только нужный язык.

**Решение:**  
- Backend использует **django-parler** и отдаёт контент в активной локали.  
- Frontend отправляет заголовок `Accept-Language` в каждом запросе.  
- Локаль хранится в Cookie → redux → next-intl → API.

### 2) **Рендеринг больших HTML-документов (отчёты, хроники)**

**Сложность:**  
Контент — большие HTML-блоки с вложенными таблицами, списками, заголовками, маркированными списками.

**Решение:**  
- Чистый HTML приходит с backend.  
- На frontend — **html-react-parser** + кастомные правила пост-обработки:  
  - замена `<img>` на оптимизированный компонент,
  - авто составление галереи для подряд идущих изображений для удобного просмотра
  - автоматическое добавление атрибута `data-gallery` при необходимости.

### 3) **Глобальная навигация по секциям (Scroll Spy)**

**Сложность:**  
Большие статьи требуют навигации по подразделам справа.

**Решение:**  
- Собственный хук `useScrollSpy` на базе `IntersectionObserver`.  
- Контекст `RightNavContext` хранит активный раздел.  
- В `pageSectionsNav.tsx` генерируется дерево секций из DOM.

### 4) **Фотогалерея / медиаархив**

**Сложность:**  
Нужно единое модальное окно для изображений с любого места сайта.

**Решение:**  
Глобальный компонент:  
<GlobalLightbox /> ```

Который:

слушает DOM-клики,

собирает группу изображений по data-gallery,

показывает через YARL (Lightbox).

### 5) SSR + i18n + API рендер

Условие: сайт должен быть индексируемым и быстрым.

Решение:
SSR-рендер + SSG там, где возможно (новости, проекты, отчёты).

**Структура репозиториев**
frontend/      → React/Next.js, UI, интерактив, мультиязычность
backend/       → Django/DRF, API, модели, мультиязычность


**Крупные функциональные области портала ФЛНКА**

Официальная хроника ФЛНКА

Проекты и инициативы

Исторические материалы и исследования

Медиа: фотоархивы, документы, публикации

Отчёты и аналитика

Новости и пресс-релизы

Контакты и структура ФЛНКА

Международная и межрегиональная деятельность

Архив конгрессов ФЛНКА

Telegram-лента


**Запуск проекта, CI/CD, инфраструктура**

Проект легко интегрируется в DevOps-окружение:
готов для Docker
В продакшн репозитории настроен CI/CD
Nginx проксирует к Gunicorn/Uvicorn
фронтенд может быть собран на Vercel или в Docker
